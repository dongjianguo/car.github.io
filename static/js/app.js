function Ship(a){gameMonitor.im.loadImage(["static/img/player.png"]);this.width=40;this.height=80;this.left=gameMonitor.w/2-this.width/2;this.top=gameMonitor.h-2*this.height;this.player=gameMonitor.im.createImage("static/img/player.png");this.paint=function(){a.drawImage(this.player,this.left,this.top,this.width,this.height)};this.setPosition=function(c){if(gameMonitor.isMobile()){var d=c.changedTouches[0].clientX;var b=c.changedTouches[0].clientY}else{var d=c.offsetX;var b=c.offsetY}this.left=d-this.width/2-16;this.top=b-this.height/2;if(this.left<0){this.left=0}if(this.left>320-this.width){this.left=320-this.width}if(this.top<0){this.top=0}if(this.top>gameMonitor.h-this.height){this.top=gameMonitor.h-this.height}this.paint()};this.controll=function(){var f=this;var e=$("#gamepanel");var d=this.left,c=this.top,b=false;e.on(gameMonitor.eventType.start,function(g){f.setPosition(g);b=true}).on(gameMonitor.eventType.end,function(){b=false}).on(gameMonitor.eventType.move,function(g){g.preventDefault();if(b){f.setPosition(g)}})};this.eat=function(e){for(var d=e.length-1;d>=0;d--){var g=e[d];if(g){var c=this.top+this.height/2-(g.top+g.height/2);var b=this.left+this.width/2-(g.left+g.width/2);var h=Math.sqrt(c*c+b*b);if(h<=this.height/2+g.height/2){e[g.id]=null;if(g.type==0){gameMonitor.stop();$("#gameoverPanel").show();setTimeout(function(){$("#gameoverPanel").hide();$("#resultPanel").show();gameMonitor.getScore()},2000)}else{$("#score").text(++gameMonitor.score);$(".heart").removeClass("hearthot").addClass("hearthot");setTimeout(function(){$(".heart").removeClass("hearthot")},200)}}}}}}function Food(a,c,d){this.speedUpTime=300;this.id=d;this.type=a;this.width=50;this.height=50;this.left=c;this.top=-50;this.speed=0.04*Math.pow(1.2,Math.floor(gameMonitor.time/this.speedUpTime));this.loop=0;var b=this.type==0?"static/img/food1.png":"static/img/food2.png";this.pic=gameMonitor.im.createImage(b)}Food.prototype.paint=function(a){a.drawImage(this.pic,this.left,this.top,this.width,this.height)};Food.prototype.move=function(a){if(gameMonitor.time%this.speedUpTime==0){this.speed*=1.2}this.top+=++this.loop*this.speed;if(this.top>gameMonitor.h){gameMonitor.foodList[this.id]=null}else{this.paint(a)}};function ImageMonitor(){var a=[];return{createImage:function(b){return typeof a[b]!="undefined"?a[b]:(a[b]=new Image(),a[b].src=b,a[b])},loadImage:function(b,f){for(var e=0,c=b.length;e<c;e++){var d=b[e];a[d]=new Image();a[d].onload=function(){if(e==c-1&&typeof f=="function"){f()}};a[d].src=d}}}}var gameMonitor={w:320,h:568,bgWidth:320,bgHeight:1126,time:0,timmer:null,bgSpeed:2,bgloop:0,score:0,im:new ImageMonitor(),foodList:[],bgDistance:0,eventType:{start:"touchstart",move:"touchmove",end:"touchend"},init:function(){var d=this;var c=document.getElementById("stage");var a=c.getContext("2d");var b=new Image();d.bg=b;b.onload=function(){a.drawImage(b,0,0,d.bgWidth,d.bgHeight)};b.src="static/img/bg.jpg";d.initListener(a)},initListener:function(b){var c=this;var a=$(document.body);$(document).on(gameMonitor.eventType.move,function(d){d.preventDefault()});a.on(gameMonitor.eventType.start,".replay, .playagain",function(){$("#resultPanel").hide();var e=document.getElementById("stage");var d=e.getContext("2d");c.ship=new Ship(d);c.ship.controll();c.reset();c.run(d)});a.on(gameMonitor.eventType.start,"#frontpage",function(){$("#frontpage").css("left","-100%")});a.on(gameMonitor.eventType.start,"#guidePanel",function(){$(this).hide();c.ship=new Ship(b);c.ship.paint();c.ship.controll();gameMonitor.run(b)});a.on(gameMonitor.eventType.start,".share",function(){$(".weixin-share").show().on(gameMonitor.eventType.start,function(){$(this).hide()})});WeixinApi.ready(function(d){var f={appId:"",imgUrl:"static/img/food2.png",link:"http://dev.360.cn/html/zhuanti/yutu.html",desc:"开跑车，抢汽油",title:"抢汽油"};var g={appId:"",imgUrl:"static/img/food2.png",link:"http://dev.360.cn/html/zhuanti/yutu.html",desc:"“开跑车，抢汽油”",title:"抢汽油"};var e={ready:function(){},cancel:function(h){},fail:function(h){},confirm:function(h){},all:function(h){}};d.shareToFriend(f,e);d.shareToTimeline(g,e);d.shareToWeibo(f,e)})},rollBg:function(a){if(this.bgDistance>=this.bgHeight){this.bgloop=0}this.bgDistance=++this.bgloop*this.bgSpeed;a.drawImage(this.bg,0,this.bgDistance-this.bgHeight,this.bgWidth,this.bgHeight);a.drawImage(this.bg,0,this.bgDistance,this.bgWidth,this.bgHeight)},run:function(a){var c=gameMonitor;a.clearRect(0,0,c.bgWidth,c.bgHeight);c.rollBg(a);c.ship.paint();c.ship.eat(c.foodList);c.genorateFood();for(i=c.foodList.length-1;i>=0;i--){var b=c.foodList[i];if(b){b.paint(a);b.move(a)}}c.timmer=setTimeout(function(){gameMonitor.run(a)},Math.round(1000/60));c.time++},stop:function(){var a=this;$("#stage").off(gameMonitor.eventType.start+" "+gameMonitor.eventType.move);setTimeout(function(){clearTimeout(a.timmer)},0)},genorateFood:function(){var b=50;var a=Math.random();if(a*b>b-1){var e=Math.random()*(this.w-50);var c=Math.floor(e)%2==0?0:1;var g=this.foodList.length;var d=new Food(c,e,g);this.foodList.push(d)}},reset:function(){this.foodList=[];this.bgloop=0;this.score=0;this.timmer=null;this.time=0;$("#score").text(this.score)},getScore:function(){var b=Math.floor(this.time/60);var c=this.score;var a=1;if(c==0){$("#scorecontent").html('真遗憾，您竟然<span class="lighttext">一桶</span>油也没有抢到！');$(".btn1").text("大侠请重新来过").removeClass("share").addClass("playagain");$("#fenghao").removeClass("geili yinhen").addClass("yinhen");return}else{if(c<10){a=2}else{if(c>10&&c<=20){a=10}else{if(c>20&&c<=40){a=40}else{if(c>40&&c<=60){a=80}else{if(c>60&&c<=80){a=92}else{if(c>80){a=99}}}}}}}$("#fenghao").removeClass("geili yinhen").addClass("geili");$("#scorecontent").html('您在<span id="stime" class="lighttext">2378</span>秒内准确抢了 <span id="sscore" class="lighttext">88</span>桶油<br>超过了<span id="suser" class="lighttext">88%</span>的用户!');$("#stime").text(b);$("#sscore").text(c);$("#suser").text(a+"%");$(".btn1").text("请小伙伴来抢油").removeClass("playagain").addClass("share")},isMobile:function(){var c=navigator.userAgent.toLowerCase(),k=c.match(/ipad/i)=="ipad",j=c.match(/iphone os/i)=="iphone os",b=c.match(/midp/i)=="midp",d=c.match(/rv:1.2.3.4/i)=="rv:1.2.3.4",e=c.match(/ucweb/i)=="ucweb",g=c.match(/android/i)=="android",a=c.match(/windows ce/i)=="windows ce",h=c.match(/windows mobile/i)=="windows mobile",f=c.match(/webview/i)=="webview";return(k||j||b||d||e||g||a||h)}};if(!gameMonitor.isMobile()){gameMonitor.eventType.start="mousedown";gameMonitor.eventType.move="mousemove";gameMonitor.eventType.end="mouseup"}gameMonitor.init();